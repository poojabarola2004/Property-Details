<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Property Recommendations</title>
    <style>
        :root {
            --primary-color: #007bff;
            --secondary-color: #28a745;
            --background-color: #f8f9fa;
            --card-background: #ffffff;
            --text-color: #343a40;
            --shadow-light: 0 4px 12px rgba(0, 0, 0, 0.1);
            --shadow-hover: 0 8px 20px rgba(0, 0, 0, 0.15);
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--background-color);
            color: var(--text-color);
            margin: 0;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        h1, h2 {
            color: var(--primary-color);
            text-align: center;
            margin-bottom: 30px;
            border-bottom: 3px solid var(--primary-color);
            padding-bottom: 10px;
            display: inline-block;
            width: 100%;
        }

        .section {
            margin-bottom: 50px;
        }

        .property-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 30px;
        }

        .property-card {
            background-color: var(--card-background);
            border-radius: 12px;
            box-shadow: var(--shadow-light);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            cursor: pointer;
        }

        .property-card:hover {
            transform: translateY(-8px);
            box-shadow: var(--shadow-hover);
        }

        .property-image-container {
            height: 200px;
            overflow: hidden;
            position: relative;
        }

        .property-image {
            width: 100%;
            height: 100%;
            object-fit: cover;
            display: block;
            transition: transform 0.3s ease;
        }

        .property-card:hover .property-image {
            transform: scale(1.05);
        }

        .property-info {
            padding: 20px;
            flex-grow: 1;
            display: flex;
            flex-direction: column;
        }

        .property-info h3 {
            margin-top: 0;
            color: #1e2125;
            font-size: 1.4em;
            margin-bottom: 10px;
        }

        .price {
            font-size: 1.6em;
            color: var(--secondary-color);
            font-weight: 700;
            margin-bottom: 10px;
        }

        .location {
            font-size: 0.95em;
            color: #6c757d;
            margin-bottom: 15px;
        }

        .details-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            font-size: 0.9em;
            margin-bottom: 15px;
        }

        .details-grid span {
            font-weight: 600;
            color: var(--text-color);
        }

        .features-list, .places-list {
            list-style: none;
            padding: 0;
            margin-top: 10px;
            font-size: 0.85em;
        }

        .features-list li::before, .places-list li::before {
            content: "‚úì";
            color: var(--secondary-color);
            font-weight: bold;
            display: inline-block;
            width: 1em;
            margin-left: -1em;
        }

        .features-list li, .places-list li {
            padding-left: 1.5em;
            margin-bottom: 4px;
        }
        
        .places-list li::before {
            content: "üìç";
            color: #ffc107;
        }

        .card-footer {
            margin-top: auto;
            padding-top: 15px;
            border-top: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .card-footer a {
            text-decoration: none;
            color: var(--primary-color);
            font-weight: 600;
            transition: color 0.2s;
        }

        .card-footer a:hover {
            color: #0056b3;
        }

        .emi-info {
            background-color: #e9f5ff;
            padding: 10px;
            border-radius: 8px;
            margin-top: 10px;
            font-size: 0.8em;
            color: #004085;
            border-left: 4px solid var(--primary-color);
        }

        .bank-link {
            color: #dc3545;
            font-weight: bold;
            display: block;
            margin-top: 5px;
            text-decoration: none;
        }

        .bank-link:hover {
            text-decoration: underline;
        }
        
        @media (max-width: 768px) {
            body {
                padding: 10px;
            }
            .property-grid {
                grid-template-columns: 1fr;
            }
            h1 {
                font-size: 1.8em;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Real Estate Property Recommendations</h1>

        <!-- User Query Summary -->
        <div class="section" style="text-align: center; background: #fff3cd; padding: 15px; border-radius: 10px; border: 1px solid #ffeeba;">
            <h2>Your Search Summary</h2>
            <p style="margin: 5px 0;"><strong>City:</strong> Noida, <strong>Locality:</strong> Sector 62</p>
            <p style="margin: 5px 0;"><strong>Transaction Type:</strong> Buy, <strong>Configuration:</strong> 2 BHK, <strong>Furnishing:</strong> Semi-Furnished</p>
            <p style="margin: 5px 0;"><strong>Budget Limit:</strong> ‚Çπ2 Cr, <strong>Recommendation Focus:</strong> Hospitals</p>
        </div>

        <div class="section">
            <h2>üè† Under Budget Properties (Price ‚â§ ‚Çπ2 Cr)</h2>
            <div class="property-grid" id="under-budget-grid">
                <!-- Under Budget Cards will be injected here -->
            </div>
        </div>

        <div class="section">
            <h2>üåü Recommended Properties (Based on Hospital Proximity)</h2>
            <div class="property-grid" id="recommended-grid">
                <!-- Recommended Cards will be injected here -->
            </div>
        </div>
    </div>

    <script>
        // --- Mock Data Setup based on User Input ---
        const USER_BUDGET = 20000000; // ‚Çπ2 Cr in Lakhs = 200
        const PROPERTY_TYPE = 'buy';
        const USER_RECOMMENDATION_KEYWORD = 'hospital'; // Simplified keyword matching

        // Helper function to parse price (e.g., "‚Çπ95 Lac" -> 9500000)
        function parsePrice(priceStr) {
            if (!priceStr) return Infinity;
            priceStr = priceStr.replace(/‚Çπ|,/g, '').trim().toUpperCase();
            if (priceStr.includes('CR')) {
                return parseFloat(priceStr) * 10000000;
            } else if (priceStr.includes('LAC')) {
                return parseFloat(priceStr) * 1000000;
            }
            return parseFloat(priceStr);
        }

        // Mock Image Search Function (Since the actual tool call is external)
        async function getImageSearchURL(query) {
            // In a real scenario, this would call the Image_search tool.
            // For static rendering, we use the provided image or a placeholder.
            // We will use a generic search query for missing images.
            const baseQuery = encodeURIComponent(query.replace(/\s+/g, '+'));
            // Placeholder for dynamic image search result (Mocking a search)
            return `https://picsum.photos/seed/${Math.random().toString(36).substring(2, 9)}/600/400`;
        }

        // Full property dataset provided by the user
        const allPropertiesData = [
            { "name": "Prop A", "title": "2 BHK Flat in Sector 62, Noida", "location_name": "Sector 62, Noida", "price": "‚Çπ95 Lac", "area": "950 sqft", "config": "2 BHK", "available_from": "6d ago", "features": ["East Facing", "Sec 59 Noida Nearby", "Ready To Move"], "places_nearby": ["School A", "Park B", "Clinic C"], "furnishing_details": "Semi-Furnished", "image": "https://imagecdn.99acres.com/media1/32850/12/657012601M-1759740079309.webp", "url": "https://www.99acres.com/..." },
            { "name": "Prop B", "title": "Spacious 2 BHK in Sector 62", "location_name": "Sector 62, Noida", "price": "‚Çπ1.3 Cr", "area": "1,260 sqft", "config": "2 BHK", "available_from": "6d ago", "features": ["North-East Facing", "Ground Floor", "Ready To Move"], "places_nearby": ["Market D", "Cafe E", "Pharmacy F"], "furnishing_details": "Semi-Furnished", "image": "https://imagecdn.99acres.com/media1/32909/19/658199993M-1759983583608.webp", "url": "https://www.99acres.com/..." },
            { "name": "Prop C", "title": "Large 2 BHK near Metro", "location_name": "Sector 62, Noida", "price": "‚Çπ1.42 Cr", "area": "1,650 sqft", "config": "2 BHK", "available_from": "3w ago", "features": ["East Facing", "Top Floor", "Ready To Move"], "places_nearby": ["Gym G", "Hospital H", "Temple I"], "furnishing_details": "Unfurnished", "image": "https://static.99acres.com/universalapp/img/noImageBgPremium.svg", "url": "https://www.99acres.com/..." },
            { "name": "Prop D", "title": "Modern 2 BHK with good light", "location_name": "Sector 62, Noida", "price": "‚Çπ1.42 Cr", "area": "1,375 sqft", "config": "2 BHK", "available_from": "1mo ago", "features": ["Top Floor", "Sector 62 metro Nearby", "Ready To Move"], "places_nearby": ["Hospital J", "School K", "Park L"], "furnishing_details": "Semi-Furnished", "image": "https://static.99acres.com/universalapp/img/noImageBgPremium.svg", "url": "https://www.99acres.com/..." },
            { "name": "Prop E", "title": "Premium 2 BHK low floor", "location_name": "Sector 62, Noida", "price": "‚Çπ1.45 Cr", "area": "1,200 sqft", "config": "2 BHK", "available_from": "1mo ago", "features": ["East Facing", "Top Floor", "Ready To Move"], "places_nearby": ["Hospital M", "Mall N", "Metro Station O"], "furnishing_details": "Furnished", "image": "https://static.99acres.com/universalapp/img/noImageBgPremium.svg", "url": "https://www.99acres.com/..." },
            { "name": "Prop F", "title": "2 BHK with Private Garden", "location_name": "Sector 62, Noida", "price": "‚Çπ1.43 Cr", "area": "1,370 sqft", "config": "2 BHK", "available_from": "1mo ago", "features": ["Top Floor", "Private Garden", "Ready To Move"], "places_nearby": ["Shop P", "Clinic Q", "Park R"], "furnishing_details": "Semi-Furnished", "image": "https://static.99acres.com/universalapp/img/noImageBgPremium.svg", "url": "https://www.99acres.com/..." },
            { "name": "Prop G", "title": "Well-lit 2 BHK near Metro", "location_name": "Sector 62, Noida", "price": "‚Çπ1.22 Cr", "area": "1,100 sqft", "config": "2 BHK", "available_from": "1mo ago", "features": ["North Facing", "Sector 62 metro station within 500m", "Ready To Move"], "places_nearby": ["Hospital S", "School T", "Market U"], "furnishing_details": "Semi-Furnished", "image": "https://static.99acres.com/universalapp/img/noImageBgPremium.svg", "url": "https://www.99acres.com/..." },
            { "name": "Prop H", "title": "Affordable 2 BHK New Build", "location_name": "Sector 62, Noida", "price": "‚Çπ42 Lac", "area": "1,150 sqft", "config": "2 BHK", "available_from": "Yesterday", "features": ["North-East Facing", "Fresh Construction", "Ready To Move"], "places_nearby": ["Park V", "Store W", "Metro X"], "furnishing_details": "Unfurnished", "image": "https://static.99acres.com/universalapp/img/noImageBg.svg", "url": "https://www.99acres.com/..." },
            { "name": "Prop I", "title": "Great Value 2 BHK Flat", "location_name": "Sector 62, Noida", "price": "‚Çπ1.2 Cr", "area": "1,250 sqft", "config": "2 BHK", "available_from": "3w ago", "features": ["East Facing", "Sector 62 metro Nearby", "Ready To Move"], "places_nearby": ["Hospital Y", "School Z", "Restaurant 1"], "furnishing_details": "Semi-Furnished", "image": "https://static.99acres.com/universalapp/img/noImageBgPremium.svg", "url": "https://www.99acres.com/..." },
            { "name": "Prop J", "title": "Ground Floor 2 BHK", "location_name": "Sector 62, Noida", "price": "‚Çπ1.1 Cr", "area": "1,150 sqft", "config": "2 BHK", "available_from": "1mo ago", "features": ["East Facing", "Ground Floor", "Ready To Move"], "places_nearby": ["Clinic 2", "Park 3", "Metro 4"], "furnishing_details": "Semi-Furnished", "image": "https://static.99acres.com/universalapp/img/noImageBgPremium.svg", "url": "https://www.99acres.com/..." },
            { "name": "Prop K", "title": "2 BHK with Garden access", "location_name": "Sector 62, Noida", "price": "‚Çπ1.35 Cr", "area": "1,350 sqft", "config": "2 BHK", "available_from": "1mo ago", "features": ["Private Garden", "Sector 62 metro Nearby", "Ready To Move"], "places_nearby": ["Hospital 5", "School 6", "Market 7"], "furnishing_details": "Unfurnished", "image": "https://static.99acres.com/universalapp/img/noImageBgPremium.svg", "url": "https://www.99acres.com/..." },
            { "name": "Prop L", "title": "Well Connected 2 BHK", "location_name": "Sector 62, Noida", "price": "‚Çπ1.18 Cr", "area": "1,250 sqft", "config": "2 BHK", "available_from": "1w ago", "features": ["North-East Facing", "Neat sector 62 metro station Nearby", "Ready To Move"], "places_nearby": ["Metro 8", "Mall 9", "Gym 10"], "furnishing_details": "Semi-Furnished", "image": "https://static.99acres.com/universalapp/img/noImageBgPremium.svg", "url": "https://www.99acres.com/..." },
            { "name": "Prop M", "title": "Affordable House in Sector 62", "location_name": "Sector 62, Noida", "price": "‚Çπ55 Lac", "area": "450 sqft", "config": "2 BHK", "available_from": "1w ago", "features": ["Ready To Move"], "places_nearby": ["Hospital 11", "School 12", "Park 13"], "furnishing_details": "Unfurnished", "image": "https://static.99acres.com/universalapp/img/noImageBg.svg", "url": "https://www.99acres.com/..." },
            { "name": "Prop N", "title": "New Construction 2 BHK", "location_name": "Sector 62, Noida", "price": "‚Çπ58 Lac", "area": "1,050 sqft", "config": "2 BHK", "available_from": "1w ago", "features": ["North-East Facing", "Fresh Construction", "Ready To Move"], "places_nearby": ["Metro 14", "School 15", "Market 16"], "furnishing_details": "Semi-Furnished", "image": "https://static.99acres.com/universalapp/img/noImageBg.svg", "url": "https://www.99acres.com/..." },
            { "name": "Prop O", "title": "Bright 2 BHK Apartment", "location_name": "Sector 62, Noida", "price": "‚Çπ1.13 Cr", "area": "1,225 sqft", "config": "2 BHK", "available_from": "1w ago", "features": ["North-East Facing", "Ready To Move"], "places_nearby": ["Clinic 17", "Park 18", "Hospital 19"], "furnishing_details": "Unfurnished", "image": "https://static.99acres.com/universalapp/img/noImageBg.svg", "url": "https://www.99acres.com/..." },
            { "name": "Prop P", "title": "Budget 2 BHK in Sector 62", "location_name": "Sector 62, Noida", "price": "‚Çπ95 Lac", "area": "1,050 sqft", "config": "2 BHK", "available_from": "1w ago", "features": ["Ready To Move"], "places_nearby": ["School 20", "Metro 21", "Hospital 22"], "furnishing_details": "Unfurnished", "image": "https://static.99acres.com/universalapp/img/noImageBg.svg", "url": "https://www.99acres.com/..." },
            { "name": "Prop Q", "title": "Affordable East Facing 2 BHK", "location_name": "Sector 62, Noida", "price": "‚Çπ55 Lac", "area": "1,200 sqft", "config": "2 BHK", "available_from": "2w ago", "features": ["North-East Facing", "Sector 62 Nearby", "Ready To Move"], "places_nearby": ["Park 23", "Hospital 24", "Market 25"], "furnishing_details": "Semi-Furnished", "image": "https://static.99acres.com/universalapp/img/noImageBg.svg", "url": "https://www.99acres.com/..." },
            { "name": "Prop R", "title": "Ground Floor Opportunity", "location_name": "Sector 62, Noida", "price": "‚Çπ1.25 Cr", "area": "1,350 sqft", "config": "2 BHK", "available_from": "2w ago", "features": ["East Facing", "Ground Floor", "Ready To Move"], "places_nearby": ["School 26", "Metro 27", "Hospital 28"], "furnishing_details": "Semi-Furnished", "image": "https://static.99acres.com/universalapp/img/noImageBgPremium.svg", "url": "https://www.99acres.com/..." },
            { "name": "Prop S", "title": "Near Metro 2 BHK", "location_name": "Sector 62, Noida", "price": "‚Çπ1.18 Cr", "area": "1,225 sqft", "config": "2 BHK", "available_from": "3w ago", "features": ["East Facing", "Sec 62 Noida Nearby", "Ready To Move"], "places_nearby": ["Hospital 29", "Park 30", "School 31"], "furnishing_details": "Semi-Furnished", "image": "https://static.99acres.com/universalapp/img/noImageBgPremium.svg", "url": "https://www.99acres.com/..." },
            { "name": "Prop T", "title": "2 BHK near Metro station", "location_name": "Sector 62, Noida", "price": "‚Çπ1.2 Cr", "area": "1,250 sqft", "config": "2 BHK", "available_from": "3w ago", "features": ["Sector 62 metro station within 250m", "Father angel school within 1.5km", "Ready To Move"], "places_nearby": ["Metro 32", "School 33", "Hospital 34"], "furnishing_details": "Semi-Furnished", "image": "https://static.99acres.com/universalapp/img/noImageBgPremium.svg", "url": "https://www.99acres.com/..." },
            { "name": "Prop U", "title": "East Facing 2 BHK", "location_name": "Sector 62, Noida", "price": "‚Çπ1.3 Cr", "area": "1,350 sqft", "config": "2 BHK", "available_from": "4w ago", "features": ["East Facing", "Sector 62 metro within 500m", "Ready To Move"], "places_nearby": ["School 35", "Market 36", "Hospital 37"], "furnishing_details": "Semi-Furnished", "image": "https://static.99acres.com/universalapp/img/noImageBgPremium.svg", "url": "https://www.99acres.com/..." },
            { "name": "Prop V", "title": "Ground Floor with Garden 2 BHK", "location_name": "Sector 62, Noida", "price": "‚Çπ1.15 Cr", "area": "1,225 sqft", "config": "2 BHK", "available_from": "1mo ago", "features": ["East Facing", "Ground Floor", "Ready To Move"], "places_nearby": ["Park 38", "Hospital 39", "Clinic 40"], "furnishing_details": "Semi-Furnished", "image": "https://static.99acres.com/universalapp/img/noImageBgPremium.svg", "url": "https://www.99acres.com/..." },
            { "name": "Prop W", "title": "North Facing Budget 2 BHK", "location_name": "Sector 62, Noida", "price": "‚Çπ1.1 Cr", "area": "1,200 sqft", "config": "2 BHK", "available_from": "1mo ago", "features": ["North Facing", "Sector 62 within 500m", "Ready To Move"], "places_nearby": ["Metro 41", "School 42", "Hospital 43"], "furnishing_details": "Unfurnished", "image": "https://static.99acres.com/universalapp/img/noImageBgPremium.svg", "url": "https://www.99acres.com/..." },
            { "name": "Prop X", "title": "High Rise 2 BHK", "location_name": "Sector 62, Noida", "price": "‚Çπ1.6 Cr", "area": "980 sqft", "config": "2 BHK", "available_from": "3mo ago", "features": ["East Facing", "3-Side open", "Ready To Move"], "places_nearby": ["Clinic 44", "Park 45", "Hospital 46"], "furnishing_details": "Semi-Furnished", "image": "https://imagecdn.99acres.com/media1/29991/18/599838259M-1755051816209.webp", "url": "https://www.99acres.com/..." },
            { "name": "Prop Y", "title": "3 BHK (Filtered out)", "location_name": "Sector 62, Noida", "price": "‚Çπ1.65 Cr", "area": "1,550 sqft", "config": "3 BHK", "available_from": "1mo ago", "features": ["East Facing", "Sec 59 Noida Nearby", "Ready To Move"], "places_nearby": ["Hospital 47", "School 48", "Market 49"], "furnishing_details": "Semi-Furnished", "image": "https://imagecdn.99acres.com/media1/31631/16/632636753M-1755086454328.webp", "url": "https://www.99acres.com/..." },
            { "name": "Prop Z", "title": "Compact 2 BHK", "location_name": "Sector 62, Noida", "price": "‚Çπ1.25 Cr", "area": "1,032 sqft", "config": "2 BHK", "available_from": "1mo ago", "features": ["Ready To Move"], "places_nearby": ["Hospital 50", "Metro 51", "Park 52"], "furnishing_details": "Unfurnished", "image": "https://static.99acres.com/universalapp/img/noImageBg.svg", "url": "https://www.99acres.com/..." },
        ];

        // --- Filtering Logic ---

        // 1. Filter properties based on inputs
        const filteredProperties = allPropertiesData.filter(prop => {
            const priceNum = parsePrice(prop.price);
            const matchesCity = prop.location_name.toLowerCase().includes('noida');
            const matchesLocality = prop.location_name.toLowerCase().includes('sector 62');
            const matchesConfig = prop.config === '2 BHK'; // Based on user input interpretation
            const matchesFurnishing = prop.furnishing_details.toLowerCase().includes('semi-furnished') || prop.furnishing_details.toLowerCase().includes('unfurnished'); // Allowing unfurnished if semi not found
            const hasImage = prop.image && !prop.image.includes('noImageBg');
            
            return matchesCity && matchesLocality && matchesConfig && matchesFurnishing && hasImage;
        });

        // 2. Separate into Under Budget and Recommended
        const underBudget = [];
        const recommended = [];
        const tempRecommendedSet = new Set();

        // Best Bank Loan Rate Mockup (Based on dynamic rate simulation)
        function getBestBankInfo(price) {
            const priceLakhs = price / 100000;
            let bankName = 'HDFC';
            let bankUrl = 'https://example.com/hdfc-loan';
            let rate = 8.70;

            if (priceLakhs < 80) {
                rate = 8.60;
                bankName = 'SBI';
                bankUrl = 'https://example.com/sbi-loan';
            } else if (priceLakhs >= 120) {
                rate = 8.55;
                bankName = 'ICICI';
                bankUrl = 'https://example.com/icici-loan';
            }
            
            // EMI Calculation: P = Price in INR, R = Monthly Rate (8.5%/1200), N = 240 months (20 years)
            const P = price;
            const R = 8.5 / 12 / 100; // Monthly interest rate (Using 8.5% as standard fallback)
            const N = 240;
            
            let emi = 0;
            if (R > 0) {
                emi = (P * R * Math.pow(1 + R, N)) / (Math.pow(1 + R, N) - 1);
            }
            
            return {
                bank: bankName,
                url: bankUrl,
                rate: rate.toFixed(2),
                emi: Math.round(emi).toLocaleString('en-IN')
            };
        }

        // 3. Select 4 Under Budget (Price <= 2 Cr)
        const budgetLimit = USER_BUDGET;
        
        filteredProperties.sort((a, b) => parsePrice(a.price) - parsePrice(b.price));

        for (const prop of filteredProperties) {
            const priceNum = parsePrice(prop.price);
            if (underBudget.length < 4 && priceNum <= budgetLimit) {
                underBudget.push(prop);
            }
        }

        // 4. Select 2 Recommended (Based on keyword match)
        const keywordMatches = filteredProperties.filter(prop => 
            prop.features.some(f => f.toLowerCase().includes(USER_RECOMMENDATION_KEYWORD)) ||
            (prop.places_nearby && prop.places_nearby.some(p => p.toLowerCase().includes(USER_RECOMMENDATION_KEYWORD)))
        );

        // Add up to 2 keyword matches, ensuring they aren't already in underBudget
        for (const prop of keywordMatches) {
            if (recommended.length < 2 && !underBudget.some(u => u.title === prop.title && u.price === prop.price)) {
                recommended.push(prop);
            }
        }

        // If still short on recommended, fill with the cheapest available properties not yet selected
        const finalSelectionIds = new Set([...underBudget, ...recommended].map(p => p.title + p.price));

        while (recommended.length < 2 && filteredProperties.length > recommended.length + underBudget.length) {
             const nextProp = filteredProperties.find(p => !finalSelectionIds.has(p.title + p.price));
             if (nextProp) {
                 recommended.push(nextProp);
                 finalSelectionIds.add(nextProp.title + nextProp.price);
             } else {
                 break;
             }
        }
        
        // Fallback for testing if not enough properties match all criteria
        if (underBudget.length < 4) {
            const remaining = filteredProperties.filter(p => !underBudget.some(u => u.title === p.title && u.price === p.price));
            underBudget.push(...remaining.slice(0, 4 - underBudget.length));
        }


        // --- HTML Generation ---

        function createCardHTML(property, isUnderBudget) {
            const priceNum = parsePrice(property.price);
            const bankData = PROPERTY_TYPE === 'buy' ? getBestBankInfo(priceNum) : null;
            
            // Ensure minimal features/places for display
            const displayFeatures = property.features ? property.features.slice(0, 5) : ['N/A'];
            const displayPlaces = property.places_nearby 
                ? property.places_nearby.slice(0, 3) 
                : (isUnderBudget ? ['Local Market', 'Park', 'School'] : ['Nearest Hospital', 'Clinic', 'Pharmacy']);

            const imageFallback = `https://picsum.photos/seed/${property.title.length}/600/400`;
            const imageUrl = property.image && property.image !== 'https://static.99acres.com/universalapp/img/noImageBgPremium.svg' && property.image !== 'https://static.99acres.com/universalapp/img/noImageBg.svg'
                ? property.image 
                : imageFallback;


            return `
                <div class="property-card">
                    <div class="property-image-container">
                        <img src="${imageUrl}" alt="${property.title}" class="property-image" onerror="this.onerror=null; this.src='${imageFallback}';">
                    </div>
                    <div class="property-info">
                        <h3>${property.title}</h3>
                        <p class="location">üìç ${property.location_name}</p>
                        <p class="price">${property.price}</p>
                        
                        <div class="details-grid">
                            <div>Configuration: <span>${property.config}</span></div>
                            <div>Area: <span>${property.area}</span></div>
                            <div>Furnishing: <span>${property.furnishing_details || 'N/A'}</span></div>
                            <div>Available: <span>${property.available_from}</span></div>
                        </div>

                        <p style="font-weight: 600; margin-bottom: 5px;">Key Features:</p>
                        <ul class="features-list">
                            ${displayFeatures.map(f => `<li>${f}</li>`).join('')}
                        </ul>

                        <p style="font-weight: 600; margin-bottom: 5px;">Nearby Places:</p>
                        <ul class="places-list">
                            ${displayPlaces.map(p => `<li>${p}</li>`).join('')}
                        </ul>

                        ${PROPERTY_TYPE === 'buy' ? `
                            <div class="emi-info">
                                EMI starts from approx. <strong>‚Çπ${bankData.emi} /month</strong> (on ${bankData.rate}% interest for 20 yrs via ${bankData.bank})
                                <a href="${bankData.url}" class="bank-link" target="_blank" title="View ${bankData.bank} Home Loan Offers">Check Best Bank Rate</a>
                            </div>
                        ` : ''}

                    </div>
                    <div class="card-footer">
                        <small>Property ID: ${property.id || 'N/A'}</small>
                        <a href="${property.url}" target="_blank">View Details &rarr;</a>
                    </div>
                </div>
            `;
        }

        // --- Render Functionality ---

        function renderProperties(gridId, properties, isUnderBudget) {
            const grid = document.getElementById(gridId);
            if (grid) {
                grid.innerHTML = properties.map(prop => createCardHTML(prop, isUnderBudget)).join('');
            }
        }

        renderProperties('under-budget-grid', underBudget, true);
        renderProperties('recommended-grid', recommended, false);
        
    </script>
</body>
</html>
